<!DOCTYPE html>
<!--[if lte IE 8 ]>
<html class="ie" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<![endif]-->
<!--[if (gte IE 9)|!(IE)]><!-->
<!--
***************  *      *     *
      8          *    *       *
      8          *  *         *
      8          **           *
      8          *  *         *
      8          *    *       *
      8          *      *     *
      8          *        *   ***********    -----Theme By Kieran(http://go.kieran.top)
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh-CN" lang="zh-CN">
<!--<![endif]-->

<head>
  <title>ZJ&#39;s World</title>
  <!-- Meta data -->
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content="ZJ's World">
    <meta name="author" content="张建">
    <meta name="description" content="记录" />
    <meta name="keywords" content="" />

    <!-- Favicon, (keep icon in root folder) -->
    <link rel="Shortcut Icon" href="/img/favicon.ico" type="image/ico">

    <link rel="alternate" href="/atom.xml" title="ZJ&#39;s World" type="application/atom+xml">
    <link rel="stylesheet" href="/css/all.css" media="screen" type="text/css">
    
    <link rel="stylesheet" href="/highlightjs/vs.css" type="text/css">
    

    <!--[if IE 8]>
    <link rel="stylesheet" type="text/css" href="/css/ie8.css" />
    <![endif]-->

    <!-- jQuery | Load our jQuery, with an alternative source fallback to a local version if request is unavailable -->
    <script src="/js/jquery-1.11.1.min.js"></script>
    <script>window.jQuery || document.write('<script src="js/jquery-1.11.1.min.js"><\/script>')</script>

    <!-- Load these in the <head> for quicker IE8+ load times -->
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="/js/html5shiv.min.js"></script>
    <script src="/js/respond.min.js"></script>
    <![endif]-->

  
  
  

  <style>.col-md-8.col-md-offset-2.opening-statement img{display:none;}</style>
</head>

<!--
<body class="post-template">
-->
<body id="index" class="lightnav animsition">

      <!-- ============================ Off-canvas navigation =========================== -->

    <div class="sb-slidebar sb-right sb-style-overlay sb-momentum-scrolling">
        <div class="sb-close" aria-label="Close Menu" aria-hidden="true">
            <img src="/img/close.png" alt="Close"/>
        </div>
        <!-- Lists in Slidebars -->
        <ul class="sb-menu">
            <li><a href="/" class="animsition-link" title="Home">Home</a></li>
            <li><a href="/archives" class="animsition-link" title="archive">archives</a></li>
            <!-- Dropdown Menu -->
			 
            <li>
                <a class="sb-toggle-submenu">Works<span class="sb-caret"></span></a>
                <ul class="sb-submenu">
                    
                        <li><a href="/" target="_BLANK" class="animsition-link">AAA</a></li>
                    
                        <li><a href="/atom.xml" target="_BLANK" class="animsition-link">BBB</a></li>
                    
                </ul>
            </li>
            
            
            
            <li>
                <a class="sb-toggle-submenu">Links<span class="sb-caret"></span></a>
                <ul class="sb-submenu">
                    
                    <li><a href="http://go.kieran.top/" class="animsition-link">Kieran</a></li>
                    
                    <li><a href="http://domain.com/" class="animsition-link">Name</a></li>
                    
                </ul>
            </li>
            
        </ul>
        <!-- Lists in Slidebars -->
        <ul class="sb-menu secondary">
            
            <li><a href="/about.html" class="animsition-link" title="about">About</a></li>
            <li><a href="/atom.xml" class="animsition-link" title="rss">RSS</a></li>
        </ul>
    </div>
    
    <!-- ============================ END Off-canvas navigation =========================== -->

    <!-- ============================ #sb-site Main Page Wrapper =========================== -->

    <div id="sb-site">
        <!-- #sb-site - All page content should be contained within this id, except the off-canvas navigation itself -->

        <!-- ============================ Header & Logo bar =========================== -->

        <div id="navigation" class="navbar navbar-fixed-top">
            <div class="navbar-inner">
                <div class="container">
                    <!-- Nav logo -->
                    <div class="logo">
                        <a href="/" title="Logo" class="animsition-link">
                         <img src="/img/logo.png" alt="Logo" width="35px;"/> 
                        </a>
                    </div>
                    <!-- // Nav logo -->
                    <!-- Info-bar -->
                    <nav>
                        <ul class="nav">
                            <li><a href="/" class="animsition-link">ZJ's World</a></li>
                            <li class="nolink"><span>Always </span>Creative.</li>
                            
                            <li><a href="https://github.com/" title="Github" target="_blank"><i class="icon-github"></i></a></li>
                            
                            
                            <li><a href="https://twitter.com/" title="Twitter" target="_blank"><i class="icon-twitter"></i></a></li>
                            
                            
                            <li><a href="https://www.facebook.com/" title="Facebook" target="_blank"><i class="icon-facebook"></i></a></li>
                            
                            
                            <li><a href="https://google.com/" title="Google-Plus" target="_blank"><i class="icon-google-plus"></i></a></li>
                            
                            
                            <li><a href="http://weibo.com/" title="Sina-Weibo" target="_blank"><i class="icon-sina-weibo"></i></a></li>
                            
                            <li class="nolink"><span>Welcome!</span></li>
                        </ul>
                    </nav>
                    <!--// Info-bar -->
                </div>
                <!-- // .container -->
                <div class="learnmore sb-toggle-right">More</div>
                <button type="button" class="navbar-toggle menu-icon sb-toggle-right" title="More">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar before"></span>
                <span class="icon-bar main"></span>
                <span class="icon-bar after"></span>
                </button>
            </div>
            <!-- // .navbar-inner -->
        </div>

        <!-- ============================ Header & Logo bar =========================== -->


      
<section id="intro">
    <div class="container">
        <div class="row col-md-offset-2">
            <div class="col-md-8">
    			<span class="post-meta">
      <time datetime="2019-05-23T03:46:33.000Z" itemprop="datePublished">
          2019-05-23
      </time>
    
</span>
                <h1></h1>
            </div>
        </div>
        <div class="col-md-8 col-md-offset-2">
      		<p>SELECT<br>c.id, –租约id,<br>c.flag, –租约状态,<br>c.house_id, –房源ID,<br>c.land_company_id, –机构ID,<br>da.name, –城市,<br>wa.name, –区域,<br>wb.name, –板块,<br>ws.name, –工作站,<br>g.name , –工作组,<br>o.nickname, –拓客,<br>o.id, –拓客ID,<br>from_unixtime(int(c.create_time)), –建租时间,<br>count(cl.id), –联系房东次数,<br>from_unixtime(max(int(cl.create_time))), –最近时间,<br>c.offset_fee, –抵扣费用,<br>c.offset_memo, –抵扣备注,<br>c.front_money, –定金金额,<br>c.close_reason, –关闭原因,<br>from_unixtime(int(h.create_time)), –创建房源时间,<br>concat_ws(‘|’, collect_set( concat(case ald.room<em>type when 1 then ‘基本</em>‘ when 2 then ‘私有<em>‘  when 3 then ‘公共</em>‘ else ‘’ end,ald.device_name,ald.device_num,ald.classifier) )),  –基本项目<br>date_sub(current_date,1) –日期<br>from contract as c<br>left join house h on h.id=c.house_id<br>left join acceptance_list al on al.contract_id=c.id<br>left join acceptance_list_detail_attr ald on ald.acceptance_list_id=al.id<br>left join operator as o on c.sign_user_id = o.user_id<br>left join work_group g on g.id=o.group_id<br>left join work_group as ws on g.fid = ws.id<br>left join work_group as wb on ws.fid = wb.id<br>left join work_group as wa on wb.fid = wa.id<br>left join dd_area as da on wa.city_id=da.id<br>left join agency_company as ac on h.lan_co_id = ac.id<br>left join contract_subsidiary_info csi on csi.contract_id = c.id<br>left join <code>user</code> u on c.lan_user_id=u.id<br>left join call cl on u.mobile=cl.answer_mobile and cl.mobile=o.account and cl.create_time<c.create_time and="" cl.create_time="">c.create_time-360<em>24</em>2<br>where ac.type=2 AND c.type !=5<br>and g.id&gt;0 and o.id&gt;0 AND ac.auth_status = 2  and c.id=493567<br>group by<br>c.id,<br>c.flag,<br>c.house_id,<br>c.land_company_id,<br>da.name,<br>wa.name,<br>wb.name,<br>ws.name,<br>g.name ,<br>o.nickname,<br>o.id,<br>cl.create_time,<br>c.offset_fee,<br>c.offset_memo,<br>c.front_money,<br>c.close_reason,<br>h.create_time,<br>c.create_time<br>scp root@10.80.221.39:/home/zhangjian/phpdata/remoteReport/file/2019_07_03租约贷数据.csv /Users/zj/report_blt/暂存</c.create_time></p>
<p>scp zhangjian@47.97.65.6:/home/zhangjian/phpdata/remoteReport/file/2019_07_03租约贷数据.csv /Users/zj/report_blt/暂存</p>
<p>   select<br>   account_date as ‘日期’,<br>   city_manager as ‘城市经理’,<br>   current_target_finished as ‘当前增量完成’,<br>   target as ‘增量目标’,<br>   target_rate as ‘增量目标完成率’,<br>   current_account as ‘当周流水’,<br>   current_month_avg as ‘当月周均’,<br>   season_start_avg as ‘季初周均’,<br>   season_end_avg as ‘季末周均’,<br>   all_people as ‘总人数’,<br>   win_group_people as ‘盈利小组人数’,<br>   entry_num as ‘入职拓客数’,<br>   success_num as ‘育成拓客数’,<br>   leave_num as ‘离职A拓客数’,<br>   week_people_avg as ‘当月周均人均’,<br>   week_profit_loss as ‘当周盈亏’,<br>   new_add_house as ‘新增房源’,<br>   current_contract as ‘当周成单’<br>   from manage_data where type=1<br>   order by account_date desc,current_target_finished desc</p>
<p>   type as’类型为1城市2板块’,</p>
<p>结束时间<br>2019-07-03<br>2019-07-05<br>2019-06-25<br>2019-07-10<br>2019-07-30<br>2019-07-21<br>2019-07-05<br>2019-07-11<br>2019-08-09<br>2019-07-29<br>2019-07-01<br>2019-07-05<br>2019-07-18<br>2019-07-21<br>2019-07-12<br>2019-07-12<br>2019-07-12<br>2019-07-12<br>2019-07-12<br>2019-07-12<br>2019-07-22<br>2019-07-20<br>2019-06-24<br>2019-07-01<br>2019-07-05<br>2019-07-05<br>2019-07-18<br>2019-07-25<br>2019-07-30<br>2019-07-10<br>2019-07-17<br>2019-07-17<br>2019-08-01<br>2019-07-17<br>2019-07-27<br>2019-07-21<br>2019-07-20<br>2019-07-30<br>2019-07-20<br>2019-07-17<br>2019-06-30<br>2019-07-05<br>2019-07-11<br>2019-07-15<br>2019-07-19<br>2019-07-20<br>2019-07-25<br>2019-07-17<br>2019-06-23<br>2019-07-05<br>2019-07-22<br>2019-07-18<br>2019-07-10<br>2019-07-06<br>2019-07-10<br>2019-07-10<br>2019-07-13<br>2019-07-13<br>2019-07-19<br>2019-08-08<br>2019-07-19<br>2019-08-03<br>2019-08-02</p>
<p>张建同学，在拓客周报、月报中，要调整几个逻辑。</p>
<p>1）拍照、接电话、回电中，目标任务数是零的，<br>    在排名时，排到当中。例如排名一共排到了2000名，对于给到目标是零的拓客，其最终结果就是1000名；<br>    排名如果有2100名，那最终结果就是1050名，</p>
<pre><code>`pic_traget` int(10) DEFAULT &apos;0&apos; COMMENT &apos;拍照任务目标&apos;,

`call_all_num` int(10) DEFAULT &apos;0&apos; COMMENT &apos;来电总数&apos;,
`call_answer` int(10) DEFAULT &apos;0&apos; COMMENT &apos;来电及时接听&apos;,

`pingtai_yuyue_five_back` int(10) DEFAULT &apos;0&apos; COMMENT &apos;平台预约客五分钟回电数&apos;,
`pingtai_yuyue` int(10) DEFAULT &apos;0&apos; COMMENT &apos;平台预约客数&apos;,

`pic_rate_sort` int(10) DEFAULT &apos;0&apos; COMMENT &apos;拍照完成率排行&apos;,
`answer_rate_sort` int(10) DEFAULT &apos;0&apos; COMMENT &apos;及时接听率排行&apos;,
`back_rate_sort` int(10) DEFAULT &apos;0&apos; COMMENT &apos;预约回电率排行&apos;,
</code></pre><p>select     finish_pic,pic_traget,pic_rate_sort from personal_week where account_date = ‘2019-06-24’;</p>
<p>select pic_rate_sort,id from personal_week where account_date = ‘2019-06-24’ and finish_pic=0 and pic_traget=0;</p>
<p>select * from (<br>select @rowno:=@rowno+1 as rowno,a.pic_rate_sort from (<br>select pic_rate_sort from personal_week where account_date = ‘2019-06-24’ group by pic_rate_sort order by pic_rate_sort<br>) a,(select @rowno:=0) t<br>) a where rowno=(select round(count(distinct pic_rate_sort)/2) from personal_week where account_date = ‘2019-06-24’);</p>
<p>update personal_week;</p>
<p>2）业绩这里去掉周流水增量数据，增量排名不再作为排名参考。以绝对流水作为排名依据；</p>
<p>3）杭州拍照任务的目标调整成5张/周</p>
<p>CREATE TABLE <code>` (</code>id<code>int(11) unsigned NOT NULL AUTO_INCREMENT COMMENT &#39;主键id&#39;,
quarter VARCHAR(100) DEFAULT &#39;&#39; COMMENT=&#39;季度&#39;,
city VARCHAR(100) DEFAULT &#39;&#39; COMMENT=&#39;城市&#39;,
city_manager VARCHAR(100) DEFAULT &#39;&#39; COMMENT=&#39;城市经理&#39;,
bankuai_manager VARCHAR(100) DEFAULT &#39;&#39; COMMENT=&#39;板块经理&#39;,
work_site VARCHAR(100) DEFAULT &#39;&#39; COMMENT=&#39;工作站&#39;,
quarter_week_avg VARCHAR(100) DEFAULT &#39;&#39; COMMENT=&#39;季末周均&#39;,
PRIMARY KEY (</code>id`) USING BTREE<br>) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8 COMMENT=’工作站数据季末流水设置’;</p>
<p> p.area_name=’上海西南区’ or p.area_name=’上海东一区’ or p.area_name=’上海东二区’ or p.area_name=’上海东北区’ or p.area_name=’上海西北区’ or p.area_name=’上海北区’</p>
<p>退租：<br>    当前累计退租需求量、<br>    本周房东完成的累计退租需求量、<br>    本周新增退租需求量、<br>    本周房东完成的新增退租量</p>
<pre><code>本周房东发起的退租量
本周房东完成的累计需求量在24小时内响应数量
本周房东完成的新增量在24小时内响应数量（进入选择验房方式的时间-租客发起退房申请的时间）

SELECT c.`land_company_id` as id,
COUNT(distinct case when cn.checkout_apply_from=1 and b3.contract_id is null then cn.id else null end) as 当前累计退租需求量,
count(distinct case when cn.checkout_apply_from=1 and b3.contract_id is not null then c.id else null end) 本周房东完成的累计退租需求量,
count(distinct case when cn.checkout_apply_from=1 
                     and b3.trade_success_time&gt;unix_timestamp(&apos;2019-07-01&apos;) 
                 and b3.trade_success_time&lt;unix_timestamp(&apos;2019-07-08&apos;) then c.id else null end) as 本周新增退租需求量,
count(distinct case when cn.checkout_apply_from=1 and b3.contract_id is not null
                     and b3.trade_success_time&gt;unix_timestamp(&apos;2019-07-01&apos;) 
                 and b3.trade_success_time&lt;unix_timestamp(&apos;2019-07-08&apos;) then c.id else null end) as 本周房东完成的新增退租量,             
count(distinct case when cn.checkout_apply_from=2 and unix_timestamp(cn.on_create)&gt;unix_timestamp(&apos;2019-07-01&apos;) and unix_timestamp(cn.on_create)&lt;unix_timestamp(&apos;2019-07-08&apos;) then c.id else null end) as 本周房东发起的退租量,
count(distinct case when cn.checkout_apply_from=1 and cn.respond_time-unix_timestamp(cn.on_create)&lt;24*3600 then c.id else null end) as 本周房东完成的累计需求量在24小时内响应数量,
count(distinct case when cn.checkout_apply_from=1
                 and cn.respond_time-unix_timestamp(cn.on_create)&lt;24*3600 
                 and unix_timestamp(cn.on_create)&gt;unix_timestamp(&apos;2019-07-01&apos;) 
                and unix_timestamp(cn.on_create)&lt;unix_timestamp(&apos;2019-07-08&apos;) then c.id else null end) as 本周房东完成的新增量在24小时内响应数量
from contract_checkout_new cn
left join contract c on c.id=cn.`contract_id`
left join (select contract_id,create_time,amount,trade_success_time from bill_payable_head where type=6 and flag=0 and amount&gt;0 group by contract_id) b3 on b3.contract_id=cn.contract_id 
group by c.`land_company_id`;
</code></pre><p>当前累计退租需求量：来源=租客APP，退款金额为空的数量<br>    select count(distinct cn.id),count(cn.id) from contract_checkout_new cn<br>    left join (select contract_id,create_time,amount,trade_success_time from baletoo.bill_payable_head where type=6 and flag=0 and amount&gt;0 group by contract_id) b3 on b3.contract_id=cn.contract_id where cn.checkout_apply_from=1 and b3.contract_id is null</p>
<pre><code>本周房东完成的累计退租需求量：来源为租客APP的，房东在本周退款的数量（ 退款金额&gt;=0，具体退款时间要问小黄 ）
select count(distinct cn.id),count(cn.id) from contract_checkout_new cn
left join (select contract_id,create_time,amount,trade_success_time from baletoo.bill_payable_head where type=6 and flag=0 and amount&gt;0 group by contract_id) b3 on b3.contract_id=cn.contract_id where cn.checkout_apply_from=1 and b3.contract_id is not null
and b3.trade_success_time&gt;unix_timestamp(&apos;2019-07-01&apos;) and b3.trade_success_time&lt;unix_timestamp(&apos;2019-07-08&apos;);

本周新增退租需求量、：来源-租客APP，申请时间=当周的
select count(distinct cn.id),count(cn.id) from contract_checkout_new cn
where cn.checkout_apply_from=1 
and unix_timestamp(cn.on_create)&gt;unix_timestamp(&apos;2019-07-01&apos;) 
and unix_timestamp(cn.on_create)&lt;unix_timestamp(&apos;2019-07-08&apos;);

本周房东完成的新增退租量：来源-租客APP，申请时间
select count(distinct cn.id),count(cn.id) from contract_checkout_new cn
where cn.checkout_apply_from=1 
and unix_timestamp(cn.on_create)&gt;unix_timestamp(&apos;2019-07-01&apos;) 
and unix_timestamp(cn.on_create)&lt;unix_timestamp(&apos;2019-07-08&apos;) 
and is_manage=1;

本周房东发起的退租量：申请=房东，创建时间=当周的
select count(distinct cn.id),count(cn.id) from contract_checkout_new cn
where cn.checkout_apply_from=2 
and unix_timestamp(cn.on_create)&gt;unix_timestamp(&apos;2019-07-01&apos;) 
and unix_timestamp(cn.on_create)&lt;unix_timestamp(&apos;2019-07-08&apos;);


本周房东完成的累计需求量在24小时内响应数量：房东选择验房方式在当周，且距离创建时间小于在24小时内的数量
select count(distinct cn.id),count(cn.id) from contract_checkout_new cn
where cn.checkout_apply_from=1
and cn.respond_time-unix_timestamp(cn.on_create)&lt;24*3600;  



本周房东完成的新增量在24小时内响应数量（进入选择验房方式的时间-租客发起退房申请的时间）：创建时间为当周的退房单且房东选择验房方式在24小时内的数量
select count(distinct cn.id),count(cn.id) from contract_checkout_new cn
where cn.checkout_apply_from=1
and cn.respond_time-unix_timestamp(cn.on_create)&lt;24*3600  
and unix_timestamp(cn.on_create)&gt;unix_timestamp(&apos;2019-07-01&apos;) 
and unix_timestamp(cn.on_create)&lt;unix_timestamp(&apos;2019-07-08&apos;);
</code></pre><p>转租：<br>    当前累计转租需求量<br>    本周房东完成的累计转租需求量<br>    本周新增转租需求量<br>    本周房东完成的新增转租量<br>    本周房东完成的累计需求量在24小时内响应数量<br>    本周房东完成的新增量在24小时内响应数量<br>    本周总计完成的累计需求在24小时内响应数量（包含了客服操作）<br>    本周总计完成的新增量在24小时内响应数量（包含了客服操作）（审核时间-租客发起时间）</p>
<pre><code>SELECT ac.id,
COUNT(distinct s.id) as 当前累计转租需求量,
COUNT(distinct case when sr.id is not null then s.id else null end) 本周房东完成的累计转租需求量,
COUNT(distinct case when s.create_time&gt;unix_timestamp(&apos;2019-07-01&apos;) and s.create_time&lt;unix_timestamp(&apos;2019-07-08&apos;) then s.id else null end) 本周新增转租需求量,
COUNT(distinct case when s.create_time&gt;unix_timestamp(&apos;2019-07-01&apos;) and s.create_time&lt;unix_timestamp(&apos;2019-07-08&apos;) and s.id is not null then 1 else null end) 本周房东完成的新增转租量,
COUNT(distinct case when sr.create_time&gt;0 and sr.create_time-s.create_time&lt;24*3600 then s.id else null end) as 本周房东完成的累计需求量在24小时内响应数量,
COUNT(distinct case when s.create_time&gt;unix_timestamp(&apos;2019-07-01&apos;) 
             and s.create_time&lt;unix_timestamp(&apos;2019-07-08&apos;) 
             and sr.create_time&gt;0 
             and sr.create_time-s.create_time&lt;24*3600 
             then s.id else null end) as 本周房东完成的新增量在24小时内响应数量,
COUNT(distinct case when (sr.create_time&gt;0 or sr1.create_time&gt;0) and sr.create_time-s.create_time&lt;24*3600 then s.id else null end) as 本周房东完成的累计需求量在24小时内响应数量_总,
COUNT(distinct case when s.create_time&gt;unix_timestamp(&apos;2019-07-01&apos;) 
             and s.create_time&lt;unix_timestamp(&apos;2019-07-08&apos;) 
             and ((sr.create_time&gt;0 
             and sr.create_time-s.create_time&lt;24*3600) 
             or (sr1.create_time&gt;0 
             and sr1.create_time-s.create_time&lt;24*3600))
             then s.id else null end) as 本周房东完成的新增量在24小时内响应数量_总     
from sublet_order s 
left join agency_company ac on ac.id=s.co_id
left join sublet_record sr on sr.s_order_id= s.id and sr.user_role=&apos;房东&apos;
left join sublet_record sr1 on sr1.s_order_id= s.id and sr1.user_role=&apos;后台人员&apos; 
GROUP BY ac.id;
</code></pre><p>续租：<br>    当前累计续租需求量 cr.source=1 and c.is_agency_agree =0 and c.flag =0<br>    本周房东完成的累计续租需求量 cr.source=1 and (cr.relation_contract_id is not null or cr.land_apply_status=2) </p>
<pre><code>本周新增续租需求量     cr.source=1 and unix_timestamp(cr.on_create)&gt;unix_timestamp(&apos;2019-07-01&apos;) 
                    and unix_timestamp(cr.on_create)&lt;unix_timestamp(&apos;2019-07-08&apos;)


本周房东完成的新增续租量:  unix_timestamp(cr.on_create)&gt;unix_timestamp(&apos;2019-07-01&apos;) 
                       and unix_timestamp(cr.on_create)&lt;unix_timestamp(&apos;2019-07-08&apos;)
                       and (cr.relation_contract_id is not null or cr.land_apply_status=2)

本周房东发起的续租量：unix_timestamp(cr.on_create)&gt;unix_timestamp(&apos;2019-07-01&apos;) 
                   and unix_timestamp(cr.on_create)&lt;unix_timestamp(&apos;2019-07-08&apos;)
                   and cr.source in (4,5) 

本周房东完成的累计需求量在72小时内响应数量  (c1.create_time&gt;0 and c1.create_time-unix_timestamp(cr.on_create)&lt;72*3600) 
                                   or (unix_timestamp(cr.on_create)-unix_timestamp(cr.land_apply_date)&lt;72*3600)


本周房东完成的新增量在72小时内响应数量（房东操作时间-租客申请时间）:
                                    unix_timestamp(cr.on_create)&gt;unix_timestamp(&apos;2019-07-01&apos;) 
                                       and unix_timestamp(cr.on_create)&lt;unix_timestamp(&apos;2019-07-08&apos;) 
                                    and ((c1.create_time&gt;0 and c1.create_time-unix_timestamp(cr.on_create)&lt;72*3600) 
                                    or (unix_timestamp(cr.on_create)-unix_timestamp(cr.land_apply_date)&lt;72*3600))



当前累计续租需求量：来源为租客APP的，is_agency =0 且原租约未关闭的租约数量

本周房东完成的累计续租需求量：来源为租客APP的，房东在本周创建续租租约的数量（contract_rele中relation_contract_id ！=null）+或在本周拒绝租客续租申请的数量（取contract_rele做主表，关联contract表）

本周新增续租需求量：创建时间在本周的，来源为租客APP的（取contract_rele）

本周房东完成的新增续租量：创建时间在本周，且房东在本周创建续租租约的数量+拒绝租客续租申请的数量

本周房东发起的续租量：创建时间在本周，来源=房东APP或者房东PC的数量

本周房东完成的累计需求量在72小时内响应数量：房东在本周创建续租租约-续租任务生成时间小于72小时的数量+
                                    或在本周拒绝租客续租申请-续租任务生成时间（create_time）的数量
本周房东完成的新增量在72小时内响应数量（房东操作时间-租客申请时间）:
                                  续租任务创建时间在本周，房东在本周创建续租租约-续租任务生成时间小于72小时的数量+或在本周拒绝租客续租申请-续租任务生成时间（create_time）的数量
SELECT 
c.`land_company_id` as id,
count(distinct case when cr.source=1 and cr.is_agency_agree =0 and c.flag =0 then cr.contract_id else null end) as 当前累计续租需求量,
count(distinct case when cr.source=1 and (cr.relation_contract_id is not null or cr.land_apply_status=2) then cr.contract_id else null end) as 本周房东完成的累计续租需求量,
count(distinct case when cr.source=1 and unix_timestamp(cr.on_create)&gt;unix_timestamp(&apos;2019-07-01&apos;) 
                     and unix_timestamp(cr.on_create)&lt;unix_timestamp(&apos;2019-07-08&apos;) then cr.contract_id else null end) as 本周新增续租需求量,
count(distinct case when unix_timestamp(cr.on_create)&gt;unix_timestamp(&apos;2019-07-01&apos;) 
               and unix_timestamp(cr.on_create)&lt;unix_timestamp(&apos;2019-07-08&apos;)
               and (cr.relation_contract_id is not null or cr.land_apply_status=2) then cr.contract_id else null end) as 本周房东完成的新增续租量,
count(distinct case when unix_timestamp(cr.on_create)&gt;unix_timestamp(&apos;2019-07-01&apos;) 
           and unix_timestamp(cr.on_create)&lt;unix_timestamp(&apos;2019-07-08&apos;)
           and cr.source in (4,5) then cr.contract_id else null end) as 本周房东发起的续租量,
count(distinct case when (c1.create_time&gt;0 and c1.create_time-unix_timestamp(cr.on_create)&lt;72*3600) 
                           or (unix_timestamp(cr.on_create)-unix_timestamp(cr.land_apply_date)&lt;72*3600) then cr.contract_id else null end) as 本周房东完成的累计需求量在72小时内响应数量,
count(distinct case when unix_timestamp(cr.on_create)&gt;unix_timestamp(&apos;2019-07-01&apos;) 
                               and unix_timestamp(cr.on_create)&lt;unix_timestamp(&apos;2019-07-08&apos;) 
                            and ((c1.create_time&gt;0 and c1.create_time-unix_timestamp(cr.on_create)&lt;72*3600) 
                            or (unix_timestamp(cr.on_create)-unix_timestamp(cr.land_apply_date)&lt;72*3600)) then cr.contract_id else null end) as 本周房东完成的新增量在72小时内响应数量_总

FROM `contract_rele` cr 
left join `contract` c on c.id=cr.`contract_id`
left join contract c1 on cr.relation_contract_id=c1.id 
GROUP BY c.`land_company_id`;
</code></pre><p>报修：<br>    当前累计报修申请量<br>    本周房东完成的累计需求量<br>    本周新增报修申请量<br>    本周房东完成的新增量<br>    本周房东完成的累计需求量在72小时内响应的数量<br>    本周房东完成的新增量在72小时内响应的数量<br>    count(distinct r.<code>id</code>) as 当前累计报修申请量,<br>    count(distinct case when r.finish_time&gt;0 then r.<code>id</code> else null end) as 本周房东完成的累计需求量,<br>    count(distinct case when r.create_time&gt;unix_timestamp(‘2019-07-01’) and r.create_time<unix_timestamp('2019-07-08') then="" r.`id`="" else="" null="" end)="" as="" 本周新增报修申请量,="" count(distinct="" case="" when="" r.finish_time="">unix_timestamp(‘2019-07-01’) and r.finish_time<unix_timestamp('2019-07-08') then="" r.`id`="" else="" null="" end)="" as="" 本周房东完成的新增量,="" count(distinct="" case="" when="" r.finish_time="">0 and r.finish_time-r.create_time<72*3600 then="" r.`id`="" else="" null="" end)="" as="" 本周房东完成的累计需求量在72小时内响应的数量,="" count(distinct="" case="" when="" r.create_time="">unix_timestamp(‘2019-07-01’) and r.create_time<unix_timestamp('2019-07-08') and="" r.finish_time="">0 and r.finish_time-r.create_time&lt;72*3600 then r.<code>id</code> else null end) as 本周房东完成的新增量在72小时内响应的数量</unix_timestamp('2019-07-08')></72*3600></unix_timestamp('2019-07-08')></unix_timestamp('2019-07-08')></p>
<pre><code>SELECT 
r.`company` as id,
count(distinct case when r.handle_type in（0,1）then r.`id` else null end) as 当前累计报修申请量,
count(distinct case when r.finish_time&gt;0 then r.`id` else null end) as 本周房东完成的累计需求量,
count(distinct case when r.handle_type in（0,1) and r.create_time&gt;unix_timestamp(&apos;2019-07-01&apos;) and r.create_time&lt;unix_timestamp(&apos;2019-07-08&apos;) then r.`id` else null end) as 本周新增报修申请量,
count(distinct case when r.finish_time&gt;unix_timestamp(&apos;2019-07-01&apos;) and r.finish_time&lt;unix_timestamp(&apos;2019-07-08&apos;) then r.`id` else null end) as 本周房东完成的新增量,
count(distinct case when r.finish_time&gt;0 and r.finish_time-r.create_time&lt;72*3600  then r.`id` else null end) as 本周房东完成的累计需求量在72小时内响应的数量,
count(distinct case when r.create_time&gt;unix_timestamp(&apos;2019-07-01&apos;) and r.create_time&lt;unix_timestamp(&apos;2019-07-08&apos;) and r.finish_time&gt;0 and r.finish_time-r.create_time&lt;72*3600 then r.`id` else null end) as 本周房东完成的新增量在72小时内响应的数量
FROM `repair` r 
left join `agency_company` ac on ac.id=r.`company` 
where r.`company`&gt;0 
GROUP BY r.`company`;
</code></pre><p>垫资还款：</p>
<p>当前累计未还垫资金额<br>本周房东归还的垫资金额<br>垫资笔数<br>本周房东在72小时内归还垫资的笔数（房东还款时间-垫资生成时间，以归还时间在本周进行统计）<br>本周房东在72小时内归还垫资的金额</p>
<p>回复租评：<br>    累计租评数<br>    本周新增租评数<br>    当前累计未读租评<br>    当前累计未回复租评<br>    本周在48小时内回复的租评数量（回复时间-评价时间）</p>
<pre><code>select 
count(distinct ueh.id) as 累计租评数,
count(distinct case when ueh.create_time&gt;unix_timestamp(&apos;2019-07-01&apos;) and ueh.create_time&lt;unix_timestamp(&apos;2019-07-08&apos;) then ueh.id else null end) as 本周新增租评数,
count(distinct case when ueh.is_read=0 then ueh.id else null end) as 当前累计未读租评,
count(distinct case when r.id is null then ueh.id else null end) as 当前累计未回复租评,
count(distinct case when ueh.create_time&gt;unix_timestamp(&apos;2019-07-01&apos;) and ueh.create_time&lt;unix_timestamp(&apos;2019-07-08&apos;) and r.create_time-ueh.create_time&lt;48*3600 then ueh.id else null end) 本周在48小时内回复的租评数量
from user_eval_house ueh
left join (select id,min(create_time) as create_time,eval_house_id from user_eval_house_reply where type=1 and flag=0 group by eval_house_id) r on r.eval_house_id=ueh.id
where ueh.to_type=1 group by lan_co_id;
</code></pre><p>催租反馈：<br>    累计的催租反馈数<br>    本周新增的催租反馈数<br>    本周在48小时内回复催租反馈数量</p>
<pre><code>select 
p.lan_co_id,
count(distinct p.id) as 累计的催租反馈数,
count(distinct case when p.create_time&gt;unix_timestamp(&apos;2019-07-01&apos;) and p.create_time&lt;unix_timestamp(&apos;2019-07-08&apos;) then p.id else null end) as 本周新增的催租反馈数,
count(distinct case when p.create_time&gt;unix_timestamp(&apos;2019-07-01&apos;) and p.create_time&lt;unix_timestamp(&apos;2019-07-08&apos;) and p.create_time-p.modify_time then p.id else null end) as 本周新增的催租反馈数
from pay_rent_message p 
where p.flag=0 
group by p.lan_co_id


在 pay_rent_message 表中，
通过 lan_co_id 去 重，并且ﬂag=0，
去计算机构累计的催租反馈 数，
通过create_time去判断是否本周，并且 create_time 和 modify_time 去计算48小时反馈
select 
p.lan_co_id,
count(distinct p.id) as 累计的催租反馈数,
count(distinct case when p.create_time&gt;unix_timestamp(&apos;2019-07-01&apos;) and p.create_time&lt;unix_timestamp(&apos;2019-07-08&apos;) then p.id else null end) as 本周新增的催租反馈数,
count(distinct case when p.create_time&gt;unix_timestamp(&apos;2019-07-01&apos;) and p.create_time&lt;unix_timestamp(&apos;2019-07-08&apos;) and p.modify_time-p.create_time&lt;48*3600 then p.id else null end) as 本周在48小时内回复催租反馈数量
from pay_rent_message p 
where p.flag=0 and p.lan_co_id&gt;0
group by p.lan_co_id;
</code></pre><p>$sql = “select bph.contract_id,bph.status,bph.type,bph.trade_time,bph.start_date,bph.amount,bph.settlement,bph.id as bill_payable_head_id,bph.refund_user_is_advance”;<br>$sql .= “,s.name as sub_name,s.address”;<br>$sql .= “,h.room_detail,h.room_name”;<br>$sql .= “,sum(bd.deduct_amount) as deduct_amount”;<br>$sql .= “,sum(bph_tui.amount) as tui_amount”;<br>$sql .= “ from bill_payable_head bph”;</p>
<p>$sql .= “ left join bill_payable_head_deduct_detail as bd ON bd.head_id=bph.id”;<br>$sql .= “ left join bill_payable_head as bph_tui ON bph_tui.id=bd.deduct_head_id AND bph_tui.type = 5”;<br>$sql .= “ left join contract as c ON c.id = bph.contract_id”;<br>$sql .= “ left join house as h ON h.id = c.house_id”;<br>$sql .= “ left join subdistrict as s ON s.id = h.subdistrict_id”;</p>
<p>$sql .= “ where bph.land_company_id = $co_id and bph.settlement_status &lt;&gt; 15”;<br>$sql .= “ and (bph.type = 3 or bph.type = 17 or (bph.type = 18 and bph.refund_user_is_advance=1) or bph.type = 19) and bph.amount &lt; 0 and bph.flag = 0 “;<br>$sql .= “ group by bph.id”;<br>$sql .= “ order by c.modify_time desc”;</p>
<p>CREATE EXTERNAL TABLE result.company_about_msg<br>(<br>)<br>PARTITIONED BY (monthday string) ROW FORMAT DELIMITED FIELDS TERMINATED BY ‘\001’<br>stored as textfile<br>location ‘/user/hdfs/result/company_about_msg’;</p>
<p>CREATE TABLE <code>company_about_msg</code> (<br>    id varchar(50) default ‘’ comment ‘机构id’,<br>    name varchar(50) default ‘’ comment ‘机构名称’,<br>    a1 varchar(50) default ‘’ comment ‘当前累计退租需求量’,<br>    b1 varchar(50) default ‘’ comment ‘本周房东完成的累计退租需求量’,<br>    c1 varchar(50) default ‘’ comment ‘本周新增退租需求量’,<br>    d1 varchar(50) default ‘’ comment ‘本周房东完成的新增退租量’,<br>    e1 varchar(50) default ‘’ comment ‘本周房东发起的退租量’,<br>    f1 varchar(50) default ‘’ comment ‘本周房东完成的累计需求量在24小时内响应数量’,<br>    g1 varchar(50) default ‘’ comment ‘本周房东完成的新增量在24小时内响应数量’,<br>    a2 varchar(50) default ‘’ comment ‘当前累计转租需求量’,<br>    b2 varchar(50) default ‘’ comment ‘本周房东完成的累计转租需求量’,<br>    c2 varchar(50) default ‘’ comment ‘本周新增转租需求量’,<br>    d2 varchar(50) default ‘’ comment ‘本周房东完成的新增转租量’,<br>    e2 varchar(50) default ‘’ comment ‘本周房东完成的累计需求量在24小时内响应数量’,<br>    f2 varchar(50) default ‘’ comment ‘本周房东完成的新增量在24小时内响应数量’,<br>    g2 varchar(50) default ‘’ comment ‘本周房东完成的累计需求量在24小时内响应数量<em>总’,<br>    h2 varchar(50) default ‘’ comment ‘本周房东完成的新增量在24小时内响应数量</em>总’,<br>    a3 varchar(50) default ‘’ comment ‘当前累计续租需求量’,<br>    b3 varchar(50) default ‘’ comment ‘本周房东完成的累计续租需求量’,<br>    c3 varchar(50) default ‘’ comment ‘本周新增续租需求量’,<br>    d3 varchar(50) default ‘’ comment ‘本周房东完成的新增续租量’,<br>    e3 varchar(50) default ‘’ comment ‘本周房东发起的续租量’,<br>    f3 varchar(50) default ‘’ comment ‘本周房东完成的累计需求量在72小时内响应数量’,<br>    g3 varchar(50) default ‘’ comment ‘本周房东完成的新增量在72小时内响应数量_总’,<br>    a4 varchar(50) default ‘’ comment ‘当前累计报修申请量’,<br>    b4 varchar(50) default ‘’ comment ‘本周房东完成的累计需求量’,<br>    c4 varchar(50) default ‘’ comment ‘本周新增报修申请量’,<br>    d4 varchar(50) default ‘’ comment ‘本周房东完成的新增量’,<br>    e4 varchar(50) default ‘’ comment ‘本周房东完成的累计需求量在72小时内响应的数量’,<br>    f4 varchar(50) default ‘’ comment ‘本周房东完成的新增量在72小时内响应的数量’,<br>    a5 varchar(50) default ‘’ comment ‘累计租评数’,<br>    b5 varchar(50) default ‘’ comment ‘本周新增租评数’,<br>    c5 varchar(50) default ‘’ comment ‘当前累计未读租评’,<br>    d5 varchar(50) default ‘’ comment ‘当前累计未回复租评’,<br>    e5 varchar(50) default ‘’ comment ‘本周在48小时内回复的租评数量’,<br>    a6 varchar(50) default ‘’ comment ‘累计的催租反馈数’,<br>    b6 varchar(50) default ‘’ comment ‘本周新增的催租反馈数’,<br>    c6 varchar(50) default ‘’ comment ‘本周在48小时内回复催租反馈数量’,<br>    a7 varchar(50) default ‘’ comment ‘当前累计未还垫资金额’,<br>    b7 varchar(50) default ‘’ comment ‘本周房东归还的垫资金额’,<br>    c7 varchar(50) default ‘’ comment ‘垫资笔数’,<br>    d7 varchar(50) default ‘’ comment ‘本周房东在72小时内归还垫资的笔数’,<br>    e7 varchar(50) default ‘’ comment ‘本周房东在72小时内归还垫资的金额’,<br>    create_time  varchar(50) default ‘’ string COMMENT ‘时间戳’,<br>    account_date varchar(50) default ‘’ string COMMENT ‘统计日期’,<br>    KEY <code>idx_account_date</code> (<code>account_date</code>)<br>) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT=’机构转租退租保修垫资续租等业务数据表’;<br>select<br>account<em>date  as ‘日期’,<br>id  as ‘机构id’,<br>name  as ‘机构名称’,<br>a1  as ‘当前累计退租需求量’,<br>b1  as ‘本周房东完成的累计退租需求量’,<br>c1  as ‘本周新增退租需求量’,<br>d1  as ‘本周房东完成的新增退租量’,<br>e1  as ‘本周房东发起的退租量’,<br>f1  as ‘本周房东完成的累计需求量在24小时内响应数量’,<br>g1  as ‘本周房东完成的新增量在24小时内响应数量’,<br>a2  as ‘当前累计转租需求量’,<br>b2  as ‘本周房东完成的累计转租需求量’,<br>c2  as ‘本周新增转租需求量’,<br>d2  as ‘本周房东完成的新增转租量’,<br>e2  as ‘本周房东完成的累计需求量在24小时内响应数量’,<br>f2  as ‘本周房东完成的新增量在24小时内响应数量’,<br>g2  as ‘本周房东完成的累计需求量在24小时内响应数量</em>总’,<br>h2  as ‘本周房东完成的新增量在24小时内响应数量<em>总’,<br>a3  as ‘当前累计续租需求量’,<br>b3  as ‘本周房东完成的累计续租需求量’,<br>c3  as ‘本周新增续租需求量’,<br>d3  as ‘本周房东完成的新增续租量’,<br>e3  as ‘本周房东发起的续租量’,<br>f3  as ‘本周房东完成的累计需求量在72小时内响应数量’,<br>g3  as ‘本周房东完成的新增量在72小时内响应数量</em>总’,<br>a4  as ‘当前累计报修申请量’,<br>b4  as ‘本周房东完成的累计需求量’,<br>c4  as ‘本周新增报修申请量’,<br>d4  as ‘本周房东完成的新增量’,<br>e4  as ‘本周房东完成的累计需求量在72小时内响应的数量’,<br>f4  as ‘本周房东完成的新增量在72小时内响应的数量’,<br>a5  as ‘累计租评数’,<br>b5  as ‘本周新增租评数’,<br>c5  as ‘当前累计未读租评’,<br>d5  as ‘当前累计未回复租评’,<br>e5  as ‘本周在48小时内回复的租评数量’,<br>a6  as ‘累计的催租反馈数’,<br>b6  as ‘本周新增的催租反馈数’,<br>c6  as ‘本周在48小时内回复催租反馈数量’,<br>a7  as ‘当前累计未还垫资金额’,<br>b7  as ‘本周房东归还的垫资金额’,<br>c7  as ‘垫资笔数’,<br>d7  as ‘本周房东在72小时内归还垫资的笔数’,<br>e7  as ‘本周房东在72小时内归还垫资的金额’<br>from company_about_msg order by account_date</p>
<p>from_unixtime(unix_timestamp(‘2019-07-08 00:00:00’)-3600<em>24</em>7,’yyyy-MM-dd’)</p>
<p>select<br>account_date as  ‘日期’,<br>n.城市 as  ‘城市’<br>n.板块 as  ‘板块’,<br>n.bankuai_manager_name as  ‘板块经理’<br>n.站点名称 as  ‘站点名称’,<br>dd_name as  ‘据点’,<br>week_rent_house as  ‘当周成交数’,<br>account as  ‘当周成交流水’<br>from dd_data_week d left join (<br>        select<br>        city_name ‘城市<br>        bankuai_name ‘板块’,<br>        bankuai_manager_name ‘板块经理’<br>        site_name ‘站点名称’,<br>        dd_name ‘据点’<br>        from dd_data_week<br>        where account_date=’2019-07-01’<br>) n on n.据点=d.dd_name;</p>
<p>select<br>日期 as 日期,<br>城市 as 城市,<br>板块 as 板块,<br>板块经理 as 板块经理,<br>站点名称 as 站点名称,<br>据点 as 据点,<br>当周成交数 as 当周成交数,<br>当周成交流水 as 当周成交流水<br>from<br>dd_data_week_view<br>order by 日期;</p>
<p>日期<br>机构名称<br>机构ID<br>总房数：机构所有有效房的数量<br>空房数：节点招租中的房源数数量<br>预期月总额：所有有效房的月租金总和<br>租约总额 ：留存租约的月租金+其他费用总和<br>实收总额：线上付款租金+核销+其他费用的总金额<br>线上收款总额：线上付的租金总额，不包括其他费用</p>
<p>SELECT<br>ac.id,<br>count(case when h.house_status != 2 then h.id else null end) as 总房数,<br>count(case when h.house_status=0 then h.id else null end) as 空房数,<br>sum(case when h.house_status != 2 then h.month_rent else 0 end) as 预期月总额,<br>sum(case when c.id is not null then c.month_rent+c.other_fee else ene) as 租约总额,<br>b.real_amount as 实收总额,<br>b.online_amount as 线上收款总额<br>from agency_company ac<br>left join house as h on h.lan_co_id=ac.id<br>left join subdistrict as s on h.subdistrict_id=s.id<br>left join dd_call dc on dc.id=s.dd_call_id<br>left join agency_company as ac on h.lan_co_id = ac.id<br>left join contract c on c.house_id = h.id and c.flag=0<br>left join (<br>select c.land_company_id,<br>sum(b.other_fee+b.total_amount) as real_amount,<br>sum(case when b.check_status=0 then b.total_amount else 0 end) as online_amount<br>from bill b<br>left join contract c on c.id=b.contract_id<br>where b.flag=0 and c.flag=0 and b.status=1 and c.land_company_id&gt;0<br>group by c.land_company_id) b on b.land_company_id=ac.id<br>where<br>h.<code>show</code> !=1<br>and h.virtual = 0<br>and h.house_source = 2<br>and ac.type=2<br>and ac.status=1<br>and ac.auth_status = 2<br>GROUP BY ac.id</p>
<p>select<br>c.land_company_id,<br>sum(b.other_fee+b.total_amount) as 实收总额,<br>sum(case when b.check_status=0 then else end) as 线上收款总额<br>from bill b<br>left join contract c on c.id=b.contract_id<br>where b.flag=0 and c.flag=0 and b.status=1 and c.land_company_id&gt;0 and<br>group by c.land_company_id;</p>
<p>echo “use datawarehouse;delete from company_day_data” | mysql -h rm-bp1189620q55roplq.mysql.rds.aliyuncs.com -P 3306 -ubigdata -pCflY04l1L680PM1h &gt; /home/hdfs/test/haha.txt<br>SELECT<br>da.id,<br>da.name,<br>ac.id,<br>ac.name,<br>count(case when h.house_status != 2 then h.id else null end), – 总房数,<br>count(case when h.house_status=0 then h.id else null end), – 空房数,<br>sum(case when h.house_status != 2 then h.month_rent else 0 end), – 预期月总额,<br>sum(case when c.id is not null then c.month_rent+c.other_fee else 0 end), – 租约总额,<br>b.real_amount, – 实收总额,<br>b.online_amount – 线上收款总额<br>from agency_company ac<br>left join house as h on h.lan_co_id=ac.id<br>left join subdistrict as s on h.subdistrict_id=s.id<br>left join dd_call dc on dc.id=s.dd_call_id<br>left join contract c on c.house_id = h.id and c.flag=0<br>left join dd_area da on da.id=ac.<code>city_id</code><br>left join (<br>select c.land_company_id,<br>sum(b.other_fee+b.total_amount) as real_amount,<br>sum(case when b.check_status=0 then b.total_amount else 0 end) as online_amount<br>from bill b<br>left join contract c on c.id=b.contract_id<br>where b.flag=0 and c.flag=0 and b.status=1 and c.land_company_id&gt;0<br>group by c.land_company_id) b on b.land_company_id=ac.id<br>where h.<code>hive_show</code> !=1<br>and h.virtual = 0<br>and h.house_source = 2<br>and ac.type=2<br>and ac.status=1<br>and ac.auth_status = 2<br>GROUP BY<br>da.id,<br>da.name,<br>ac.id,<br>ac.name,<br>b.real_amount,<br>b.online_amount;</p>
<p>da.id,<br>da.name,<br>ac.id,<br>ac.name,<br>count(case when h.house_status != 2 then h.id else null end), – 总房数,<br>count(case when h.house_status=0 then h.id else null end), – 空房数,<br>sum(case when h.house_status != 2 then h.month_rent else 0 end), – 预期月总额,<br>sum(case when c.id is not null then c.month_rent+c.other_fee else 0 end), – 租约总额,<br>b.real_amount, – 实收总额,<br>b.online_amount – 线上收款总额</p>
<p>CREATE EXTERNAL TABLE result.company_day_data (<br>    city string COMMENT ‘城市’,<br>    city_id string COMMENT ‘城市id’,<br>    co_id string COMMENT ‘机构id’,<br>    name string COMMENT ‘机构名称’,<br>    house_num string COMMENT ‘总房数’,<br>    empty_house_num string COMMENT ‘空房数’,<br>    pre_all_amount string comment ‘预期月总额’,<br>    contract_amount string comment ‘租约总额’,<br>    real_amount string comment ‘实收总额’,<br>    online_amount string comment ‘线上收款总额’,<br>    create_time string COMMENT ‘时间戳’<br>) PARTITIONED BY (monthday string) ROW FORMAT DELIMITED FIELDS TERMINATED BY ‘\001’<br>stored as textfile<br>location ‘/user/hdfs/result/company_day_data’;</p>

            <div class="clearfix"></div>
            <hr class="nogutter">
        </div>
        <nav class="m-pagination col-md-8 col-md-offset-2 col-sm-24" role="pagination">
    
    <a class="pull-left" href="/2019/06/18/常用l函数/" style="float: left;">
        ← 
    </a>
    
    
    <a class="pull-right" href="/2019/04/07/大牛计划/">
        进阶计划 →
    </a>
    
</nav>

        <div class="col-md-8 col-md-offset-2 col-sm-24"><script type="text/javascript">
  /**
   * 搜狐畅言
   */

  /*
  document.write('<div id="SOHUCS" sid="' + window.location.pathname.slice(1) + '" ></div>');

  window.onload = function () {
    (function () {
      var appid = 'cytXXXX';
      var conf = 'prod_xxxxxxxxxxxxxxxxx';
      var width = window.innerWidth || document.documentElement.clientWidth;
      var loadJs = function (d, a, id) {
        var c = document.getElementsByTagName("head")[0] || document.head || document.documentElement;
        var b = document.createElement("script");
        b.setAttribute("type", "text/javascript");
        b.setAttribute("charset", "UTF-8");
        b.setAttribute("src", d);
        if (id) {
          b.setAttribute("id", id);
        }
        if (typeof a === "function") {
          if (window.attachEvent) {
            b.onreadystatechange = function () {
              var e = b.readyState;
              if (e === "loaded" || e === "complete") {
                b.onreadystatechange = null;
                a()
              }
            }
          } else {
            b.onload = a
          }
        }
        c.appendChild(b)
      };

      loadJs("https://changyan.sohu.com/upload/changyan.js", function () {
        window.changyan.api.config({
          appid: appid,
          conf: conf
        })
      });
    })();
  }
  */

</script>
</div>
    </div>
</section>


      
<!-- ============================ Footer =========================== -->

<footer>
    <div class="container">
            <div class="copy">
                <p>
                    &copy; 2014<script>new Date().getFullYear()>2010&&document.write("-"+new Date().getFullYear());</script>, Content By 张建. All Rights Reserved.
                </p>
                <p>Theme By <a href="//go.kieran.top" style="color: #767D84">Kieran</a></p>
            </div>
            <div class="social">
                <ul>
                    
                    <li><a href="https://github.com/" title="Github" target="_blank"><i class="icon-github"></i></a>&nbsp;</li>
                    
                    
                    <li><a href="https://twitter.com/" title="Twitter" target="_blank"><i class="icon-twitter"></i></a>&nbsp;</li>
                    
                    
                    <li><a href="https://www.facebook.com/" title="Facebook" target="_blank"><i class="icon-facebook"></i></a>&nbsp;</li>
                    
                    
                    <li><a href="https://google.com/" title="Google-Plus" target="_blank"><i class="icon-google-plus"></i></a>&nbsp;</li>
                    
                    
                    <li><a href="http://weibo.com/" title="Sina-Weibo" target="_blank"><i class="icon-sina-weibo"></i></a>&nbsp;</li>
                    
                </ul>
            </div>
            <div class="clearfix"> </div>
        </div>
</footer>

<!-- ============================ END Footer =========================== -->
      <!-- Load our scripts -->
<!-- Resizable 'on-demand' full-height hero -->
<script type="text/javascript">
    var resizeHero = function () {
        var hero = $(".cover,.heightblock"),
            window1 = $(window);
        hero.css({
            "height": window1.height()
        });
    };

    resizeHero();

    $(window).resize(function () {
        resizeHero();
    });
</script>
<script src="/js/plugins.min.js"></script><!-- Bootstrap core and concatenated plugins always load here -->
<script src="/js/scripts.js"></script><!-- Theme scripts -->


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$('#intro').find('img').each(function(){
  var alt = this.alt;

  if (alt){
    $(this).after('<span class="caption" style="display:none">' + alt + '</span>');
  }

  $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox" rel="gallery" />');
});
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



      
</body>
</html>
